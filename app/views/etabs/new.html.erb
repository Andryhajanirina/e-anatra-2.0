<script type="text/javascript">
$(function(){
    // On va remplacer dynamiquement la latitude et longitude
    var latlng = new google.maps.LatLng(-18.906551790567445, 47.51344915311279)

    var map = new google.maps.Map(document.getElementById('newmap'),{
        zoom : 18,
        center: latlng,
        mapTypeId: google.maps.MapTypeId.ROADMAP
    });

    // Initialisation du marker
    var marker = new google.maps.Marker({
        position : latlng,
        map : map,
        title : 'Bougez ce marqueur',
        draggable : true
    });

    // Initialisation du geocoder
    var geocoder = new google.maps.Geocoder();

    google.maps.event.addListener(marker, 'drag', function(){
        setPosition(marker);
    });

    $('#address').keypress(function(e){
        if(e.keyCode === 13){
            var request = {
                address : $(this).val()
            }
            geocoder.geocode(request, function(results, status){
                if(status === google.maps.GeocoderStatus.OK){
                    map.setCenter(results[0].geometry.location);
                }
            });
            return false;
        }
    });

});

function setPosition(marker){
    var pos = marker.getPosition();
    $('#latitude').val(pos.lat());
    $('#longitude').val(pos.lng());
};
</script>
<section class="container-fluid padding-top-3x">
   <!-- .row -->
   <div class="row padding-top">
<div class="container">
<%= form_for @etab, class:"form-horizontale" do |f| %>

    <div class="form-group">
        <label for="province">Province</label>
        <%= f.collection_select :province_id, Province.order(:province_name), :id, :province_name, include_blank: true %>
    </div>

    <div class="form-group">
        <label>Image représentant votre établissement</label><br>
        <%= f.file_field :image %>
    </div>

    <div class="form-group">
        <label for="nom_etab">Nom de l'établissement</label>
        <%= f.text_field :nom_etab, class: "form-control form-control-lg" %>
    </div>

    <div class="form-group">
        <label for="email">Email</label>
        <%= f.email_field :email, class: "form-control form-control-lg" %>
    </div>

    <div class="form-group">
        <label for="phone_number">Téléphone</label>
        <%= f.telephone_field :phone_number, class: "form-control form-control-lg" %>
    </div>

    <div class="form-group">
        <label for="address">Adresse</label>
        <%= f.text_field :address, class: "form-control form-control-lg" %>
    </div>

    <div class="form-group">
        <label for="category">Catégorie</label>
        <%= f.text_field :category, class: "form-control form-control-lg" %>
    </div>

    <div class="form-group">
        <label for="description">Description de votre établissement</label>
        <%= f.text_area :description, class: "form-control form-control-lg text-editor" %>
    </div>

    <div class="form-group">
        <label>Latitude</label>
        <%= f.text_field :latitude, class: "form-control form-control-lg", readonly: "" %>
    </div>

    <div class="form-group">
        <label>Longitude</label>
        <%= f.text_field :longitude, class: "form-control form-control-lg", readonly: "" %>
    </div>

    <div class="form-group">
        <button type="submit" class="btn btn-lg btn-primary">Créer mon établissement</button>
    </div>

 <% end %>
 </div>
 </div>
 </section>
 <div id="newmap" style="width: 100%; height: 300px;"></div>